# Sprint 3 — Анімації: Детальний опис

## Що робимо

Реалізуємо повний набір анімаційних ефектів, що перетворюють консольну гру на візуальне шоу. Центральна фішка — Falling Symbols: символи відриваються від дошки і падають з фізикою обертання та колізіями.

## Як робимо

### Підхід
Анімації будуються пошарово — від простих ефектів до складних:

1. **Place Effect** (простий) — typewriter-ефект появи символу порядково
2. **Highlight** (простий) — зміна кольору winning_cells + мигання
3. **Sprites** (базовий) — створення матриць кадрів обертання для X та O
4. **Physics** (складний) — 2D фізичний engine для падіння
5. **Falling Symbols** (складний) — інтеграція спрайтів, фізики та рендерингу
6. **Draw Effect** (простий) — поступова заміна символів на dim/прозорі
7. **Result Banner** (простий) — ASCII-арт текст результату

### Технічні рішення

#### Рендеринг анімацій
- Використовувати `rich.live.Live` для оновлення екрану без мерехтіння
- Кожен кадр — повний перемальовування в `Live` context
- Target FPS: 15-30 для плавності

#### Спрайти обертання
- X: мінімум 4 фази (`╳` → `|` → `╳` → `—`) — кожна фаза це матриця 17x7
- O: мінімум 4 фази (`O` → `⬮` (вертикальний еліпс) → `O` → `⬯` (горизонтальний еліпс))
- Зберігати як `list[list[str]]` — список кадрів, кожен кадр — список рядків

#### 2D фізика
- Кожен об'єкт: `dataclass` зі станом `(x, y, vx, vy, angle, angular_velocity)`
- Гравітація: `vy += GRAVITY * dt` на кожному кадрі
- Колізії з рамками дошки (фіксовані позиції відомі з рендерера):
  - Detect: bounding box overlap
  - Resolve: бічний імпульс (`vx ±= BOUNCE_IMPULSE`), зміна `angular_velocity`
- Каскад: кожен символ починає падати з затримкою `i * CASCADE_DELAY`

#### Falling Symbols — оркестрація
- Вхід: позиції символів на дошці + winning_cells
- Порядок: спочатку не-winning символи, потім winning (або навпаки для ефекту)
- Кожен символ — незалежний `FallingObject` з власним sprite set
- Головний loop: update physics → detect collisions → resolve → render frame
- Завершення: всі об'єкти за нижньою межею екрану

#### Інтеграція з Renderer
- Анімації викликаються з `render()` при зміні `game_state`:
  - Новий хід → Place Effect
  - `game_over` + `winner` → Highlight → Falling Symbols → Result Banner
  - `game_over` + `tie` → Draw Effect → Result Banner

### Тестування
Тести пишуться разом з кожною таскою:
- task-09 → `tests/test_place_effect.py`
- task-10 → `tests/test_highlight.py`
- task-11 → `tests/test_sprites.py`
- task-12 → `tests/test_physics.py` (найбільш повне покриття — чиста математика)
- task-13 → `tests/test_falling.py`
- task-14 → `tests/test_draw_effect.py`
- task-15 → `tests/test_banner.py`

Для анімаційних модулів — smoke-тести (не crash) + unit-тести для логіки. Візуальна перевірка — вручну.

### Залежності між тасками
```
task-11 (sprites) ──→ task-13 (falling symbols)
task-12 (physics) ──→ task-13 (falling symbols)
task-09 (place) ── незалежна
task-10 (highlight) ── незалежна (потрібні winning_cells з GameState)
task-14 (draw) ── незалежна
task-15 (banner) ── незалежна
```

## Очікувані результати

1. При ході гравця символ з'являється з анімацією typewriter (порядково зверху вниз)
2. При перемозі — три клітинки мигають зеленим 2-3 рази
3. Після highlight — символи починають каскадно падати з обертанням
4. Падаючі символи обходять рамки дошки (не проходять крізь них)
5. За кожним падаючим символом — затухаючий слід
6. При нічиї — символи поступово розчиняються
7. Фінальний банер з результатом з'являється після завершення ефектів
8. Анімації не блокують і не крашать програму при будь-якому розмірі терміналу

## Контрольні точки

| # | Checkpoint | Критерій |
|---|-----------|----------|
| 1 | Place Effect | Символ з'являється з видимою анімацією, не instant |
| 2 | Highlight | Winning cells мигають зеленим, чітко видно |
| 3 | Sprites | Кожен символ має 4+ кадри обертання, візуально зрозумілих |
| 4 | Physics | Об'єкти падають з прискоренням, відскакують від перепон |
| 5 | Falling Symbols | Повна анімація: каскад, обертання, сліди, фінал |
| 6 | Draw Effect | Символи розчиняються плавно, не зникають миттєво |
| 7 | Banner | Банер чітко читається, відповідає результату |
| 8 | Integration | Всі ефекти працюють разом в повному ігровому циклі |
